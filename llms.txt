# 1Campus GPT V4 API

> 企業級 AI 對話 API，支援 SSE 串流、工具呼叫、Client Function Call。

## API 概覽

- **Base URL**: `https://gpt.1campus.net`
- **Endpoint**: `POST /v4/response`（單階段）或 `POST /v4/prepare` + `GET /v4/response/:run_token`（二階段）
- **認證**: `Authorization: Bearer <api-key>`
- **Content-Type**: `application/json`
- **回應格式**: SSE (Server-Sent Events) 或 JSON

### 使用模式選擇

- **單階段 API** (`POST /v4/response`)
  - 後端 server-to-server 呼叫，前端也可呼叫，但不建議。
  - 支援串流和非串流模式
  - 適合：後端整合、同步請求、測試開發

- **二階段 API** (`POST /v4/prepare` → `GET /v4/response/:run_token`)
  - 步驟 1：後端呼叫 `/v4/prepare` 取得 `run_token`
  - 步驟 2：前端用 `EventSource` 接收串流（支援 CORS，無需 API Key）
  - 適合：前端直接串流、解決瀏覽器 Header 限制

詳見：[Response 格式](https://ischoolinc.github.io/gpt.1campus.net-doc/response.md)

---

## 文件索引

建議閱讀順序：基礎實作 → 串流處理 → 進階功能

### 基礎實作（核心文件）

- [快速入門](https://ischoolinc.github.io/gpt.1campus.net-doc/quickstart.md) - 基本請求、串流接收、多輪對話範例
- [Request 參數](https://ischoolinc.github.io/gpt.1campus.net-doc/request.md) - 請求參數完整規格、參數約束
- [Response 格式](https://ischoolinc.github.io/gpt.1campus.net-doc/response.md) - 串流/非串流回應、TypeScript 型別定義
- [錯誤碼](https://ischoolinc.github.io/gpt.1campus.net-doc/error-codes.md) - 完整錯誤碼、重試策略、處理範例

### 串流處理（SSE 實作）

- [事件參考](https://ischoolinc.github.io/gpt.1campus.net-doc/events.md) - 客戶端事件定義、事件流程
- [事件總覽](https://ischoolinc.github.io/gpt.1campus.net-doc/events/overview.md) - 三層事件架構（Provider → Standard → Client）
- [設計原理](https://ischoolinc.github.io/gpt.1campus.net-doc/events/design-principles.md) - 事件系統設計原則

事件系列文件：

| 事件類型 | 文件 | 包含事件 | 用途 |
|---------|------|---------|------|
| Text | https://ischoolinc.github.io/gpt.1campus.net-doc/events/text-events.md | `text.started`, `text.delta`, `text.completed` | AI 回應文字 |
| Reasoning | https://ischoolinc.github.io/gpt.1campus.net-doc/events/reasoning-events.md | `reasoning.started`, `reasoning.delta`, `reasoning.completed` | 推理過程（o1 模型） |
| Tool | https://ischoolinc.github.io/gpt.1campus.net-doc/events/tool-events.md | `tool.start`, `tool.execute`, `tool.complete` | 工具呼叫、Client Function Call |
| Search | https://ischoolinc.github.io/gpt.1campus.net-doc/events/search-events.md | `web_search.*`, `file_search.*` | 搜尋狀態 |
| Iteration | https://ischoolinc.github.io/gpt.1campus.net-doc/events/iteration-events.md | `iteration.started`, `iteration.completed` | 多輪推理迭代 |
| Conversation | https://ischoolinc.github.io/gpt.1campus.net-doc/events/conversation-events.md | `conversation.started`, `conversation.paused`, `conversation.resumed`, `conversation.completed` | 對話生命週期 |

### 進階功能（特定需求）

- [Client Function Call](https://ischoolinc.github.io/gpt.1campus.net-doc/client-function-call.md) - AI 控制前端 UI（兩輪 HTTP 流程）
- [Context 模板](https://ischoolinc.github.io/gpt.1campus.net-doc/context-template.md) - 動態替換 prompt 變數
- [Title Generation](https://ischoolinc.github.io/gpt.1campus.net-doc/title-generation.md) - 對話標題生成 API
- [Input 格式](https://ischoolinc.github.io/gpt.1campus.net-doc/input.md) - 多模態輸入（圖片）、messages 處理
- [ModelOptions](https://ischoolinc.github.io/gpt.1campus.net-doc/model-options.md) - 模型參數調整、成本優化

---

## 事件快速參考

```
conversation.started    - 對話開始
conversation.paused     - 對話暫停（等待 client function 執行）
conversation.resumed    - 對話恢復
conversation.completed  - 對話完成
conversation.error      - 對話錯誤

iteration.started       - 迭代開始
iteration.completed     - 迭代完成

text.started            - 文字輸出開始
text.delta              - 文字片段（串流）
text.completed          - 文字輸出完成

tool.start              - 工具呼叫開始
tool.execute            - 請求前端執行（Client Function Call）
tool.complete           - 工具呼叫完成

reasoning.started       - 推理開始
reasoning.delta         - 推理片段
reasoning.completed     - 推理完成

web_search.started      - 網頁搜尋開始
web_search.completed    - 網頁搜尋完成
file_search.started     - 檔案搜尋開始
file_search.completed   - 檔案搜尋完成
```

---

## 實務資訊

### Timeout 處理

- 模型調用超時會回傳 `MODEL_TIMEOUT` 錯誤（HTTP 504）
- 可重試：最多 3 次，指數退避（1s, 2s, 4s）
- 詳見：[錯誤碼 - MODEL_TIMEOUT](https://ischoolinc.github.io/gpt.1campus.net-doc/error-codes.md)

### Token 使用量

- `conversation.completed` 事件包含 `token_usage` 欄位
- 格式：`{ input_tokens, output_tokens, total_tokens }`
- 用途：追蹤 API 使用量、成本計算
- 詳見：[Response 格式 - conversation.completed](https://ischoolinc.github.io/gpt.1campus.net-doc/response.md)

---

## 給 AI 助手

本文件所有連結皆為完整 URL，可直接讀取。

支援 MCP 的環境可使用：`https://gitmcp.io/ischoolinc/gpt.1campus.net-doc`
